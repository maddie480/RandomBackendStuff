# Random Discord Bots + Backend Stuff

This repository contains source code for 2 bots I am currently hosting:
- **Timezone Bot**: a bot allowing people to assign timezone roles to themselves. The roles then get updated on an hourly basis to be able to tell what time it is for someone by looking at their roles. [Invite it!](https://discord.com/oauth2/authorize?client_id=806514800045064213&scope=bot&permissions=268438528) (Beware that the hourly role updating causes a lot of entries to be added to your server's audit logs.)
- **Mod Structure Verifier**: a bot that downloads zips from Discord attachments or Google Drive links posted in a specific channel, and check if they are properly structured Celeste mods for [Everest](https://github.com/EverestAPI/Everest). This is useful to enforce a structure for collabs/contests. [Invite it!](https://discord.com/oauth2/authorize?client_id=809572233953542154&scope=bot&permissions=19520)

This is not structured as a proper Java project since those bots are run as part of a bigger package (among a lot of private and personal stuff), and running them requires some server setup. This is open sourced in case someone wants to know how the bots work, or wants to reuse them. As such, the pom.xml has dependencies that are not needed for any of the code that was published here. (This allows me to keep them up-to-date as well with Dependabot.)

This repository also contains **other classes not related to those two bots**, but that are bundled with them in my backend, and take part in the operations of [max480-random-stuff.appspot.com](https://github.com/max4805/RandomStuffWebsite) and the [Update Checker server](https://github.com/max4805/EverestUpdateCheckerServer). Everything I run that is related to Celeste is published here:

- `GameBananaAutomatedChecks`: ran once a day, at midnight French time. This runs some checks on all GameBanana submissions to help with moderation and detection of common issues:
  - code mods that use `yield return orig(self)` are reported, because using that in a hook causes 1 or 2-frame delays that are only noticed by people TASing the game.
  - code mods that use `GetFunctionPointer()` to get a pointer to a function and "skip" some parent classes (for example calling `ParentOfParentClass.Method()` instead of `ParentClass.Method()`) are reported, because those cause crashes on Mac only and with no error log, making troubleshooting quite tedious.
  - mods that ship with files included with Celeste or Everest are reported, because this is unnecessary at best... or illegal at worst (in the case of Celeste.exe).
  - files that have the same everest.yaml name as another file while being attached to a different mod are reported, because that probably means there is a mod name conflict. **If one of them is marked "Obsolete" on GameBanana, it will not raise an alert**, since it means one mod makes the other obsolete.
- `CustomEntityCatalogGenerator`: run after `GameBananaAutomatedChecks`. It collects all information necessary to display the [Custom Entity Catalog](https://max480-random-stuff.appspot.com/celeste/custom-entity-catalog) from the update checker database, and writes it in JSON form for the website to pick up.
- `UpdateCheckerTracker`: this one tracks the logs produced by the [Update Checker server](https://github.com/max4805/EverestUpdateCheckerServer), and re-posts relevant lines to a Discord channel. It also calls some APIs on [max480-random-stuff.appspot.com](https://github.com/max4805/RandomStuffWebsite) in order to refresh caches (and [the Lua Cutscenes documentation mirror](https://storage.googleapis.com/lua-cutscenes-documentation/index.html), if necessary) when the update check is over.
- `CelesteStuffHealthCheck`: a bunch of methods that are run hourly or daily to check everything is fine on [max480-random-stuff.appspot.com](https://github.com/max4805/RandomStuffWebsite), [max480-random-stuff.herokuapp.com](https://github.com/max4805/RandomStuffWebsiteJS) and [Everest](https://everestapi.github.io). If one of those methods crashes, I'm notified through a Discord bot. Quite handy so that I don't have to monitor all of that myself. :sweat_smile: `check_gb.sh` goes with that as well.
